# ğŸ“Š åŸºäº ReAct æ¶æ„çš„æ™ºèƒ½æ³•è§„å®¡æ ¸ç³»ç»Ÿè®¾è®¡ä¸å®ç°

> *åœ¨å½“ä»Šæ•°å­—åŒ–æ—¶ä»£ï¼Œå„ç±»å¹¿å‘Šå’Œæ–‡æ¡£çš„åˆè§„æ€§å®¡æ ¸å˜å¾—è¶Šæ¥è¶Šé‡è¦ï¼ŒåŒæ—¶ä¹Ÿé¢ä¸´ç€å·¨å¤§çš„æŒ‘æˆ˜ã€‚å¦‚ä½•é«˜æ•ˆã€å‡†ç¡®åœ°å®¡æ ¸å¤§é‡æ–‡æ¡£ï¼Œç¡®ä¿å…¶ç¬¦åˆå„é¡¹æ³•è§„è¦æ±‚ï¼Œæˆä¸ºä¸€ä¸ªäºŸå¾…è§£å†³çš„é—®é¢˜ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»ä¸€ä¸ªåŸºäº ReActï¼ˆReasoning + Actingï¼‰æ¶æ„çš„æ™ºèƒ½æ³•è§„å®¡æ ¸ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨è§£ææ³•å¾‹æ¡æ–‡ï¼Œå¹¶åˆ©ç”¨å¤šæ¨¡æ€ AI æŠ€æœ¯è¿›è¡Œæ™ºèƒ½å®¡æ ¸ã€‚*

## ğŸ“‘ ç›®å½•

- [1. ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
- [2. æ ¸å¿ƒæŠ€æœ¯å®ç°](#2-æ ¸å¿ƒæŠ€æœ¯å®ç°)
- [3. å®è·µæ¡ˆä¾‹åˆ†æ](#3-å®è·µæ¡ˆä¾‹åˆ†æ)
- [4. æœ€ä½³å®è·µå»ºè®®](#4-æœ€ä½³å®è·µå»ºè®®)
- [5. æœªæ¥å±•æœ›](#5-æœªæ¥å±•æœ›)
- [6. æ€»ç»“](#6-æ€»ç»“)
- [å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 æ ¸å¿ƒåŠŸèƒ½

- ğŸ” **æ³•è§„æ–‡æœ¬æ™ºèƒ½è§£æ**ï¼šè‡ªåŠ¨å°†æ³•å¾‹æ¡æ–‡è½¬æ¢ä¸ºç»“æ„åŒ–è§„åˆ™åº“
- ğŸ“„ **å¤šæ¨¡æ€æ–‡æ¡£å®¡æ ¸**ï¼šæ”¯æŒ PDFã€å›¾ç‰‡ç­‰å¤šç§æ ¼å¼çš„æ–‡æ¡£å®¡æ ¸
- ğŸ”„ **è‡ªé€‚åº”å®¡æ ¸æµç¨‹**ï¼šåŸºäº ReAct æ¶æ„å®ç°å¤æ‚çš„æ¡ä»¶åˆ¤æ–­å’Œå·¥å…·è°ƒç”¨
- ğŸ¯ **æ™ºèƒ½åœºæ™¯è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«æ–‡æ¡£ç±»å‹å’Œé€‚ç”¨è§„åˆ™

### 1.2 æŠ€æœ¯æ¶æ„

æ•´ä¸ªç³»ç»Ÿä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¨¡å—ç»„æˆï¼š
- âš™ï¸ **è§„åˆ™è§£æå™¨**ï¼šå°†æ³•å¾‹æ¡æ–‡è½¬æ¢ä¸ºç»“æ„åŒ–è§„åˆ™
- ğŸ® **å®¡æ ¸æ§åˆ¶å™¨**ï¼šåè°ƒå„ä¸ªç»„ä»¶çš„å·¥ä½œæµç¨‹
- ğŸ§° **å·¥å…·é›†æˆå±‚**ï¼šæä¾› OCRã€å›¾åƒæ¯”å¯¹ç­‰åŸºç¡€èƒ½åŠ›
- ğŸ’¬ **æç¤ºè¯å¼•æ“**ï¼šç®¡ç†ä¸ LLM çš„äº¤äº’æ¨¡æ¿

---

## 2. æ ¸å¿ƒæŠ€æœ¯å®ç°

### 2.1 ReAct æ¶æ„è®¾è®¡

> **ReAct** æ˜¯ä¸€ç§ç»“åˆæ¨ç†ï¼ˆReasoningï¼‰å’Œè¡ŒåŠ¨ï¼ˆActingï¼‰çš„ AI æ¶æ„ï¼Œä½¿ AI èƒ½å¤Ÿ:
> 1. æ€è€ƒå½“å‰çŠ¶æ€å’Œéœ€æ±‚
> 2. å†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
> 3. æ‰§è¡Œè¡ŒåŠ¨å¹¶è§‚å¯Ÿç»“æœ
> 4. åŸºäºç»“æœç»§ç»­æ¨ç†

ä¸‹é¢æ˜¯ç³»ç»Ÿä¸­çš„ ReAct å®ç°ç¤ºä¾‹ï¼š

```python
async def _execute_react_loop(self, 
                           prompt: str, 
                           max_steps: int = 5,
                           temperature: float = 0.7) -> Dict[str, Any]:
    """æ‰§è¡Œ ReAct å¾ªç¯"""
    try:
        current_prompt = prompt
        history = []
        
        for step in range(max_steps):
            # è·å–LLMå“åº”
            response = await llm_chat(current_prompt, temperature=temperature)
            
            # è§£ææœ€è¿‘çš„å·¥å…·è°ƒç”¨
            tool_name, tool_args = await self._parse_latest_plugin_call(response)
            if not tool_name:
                continue
                
            # æ‰§è¡Œå·¥å…·è°ƒç”¨
            result = await self._execute_tool(tool_name, tool_args)
            
            # è®°å½•å†å²
            history.append({
                "step": step + 1,
                "thought": self._extract_thought(response),
                "action": f"{tool_name}: {json.dumps(tool_args)}",
                "result": result
            })
            
            # æ›´æ–°æç¤ºè¯
            current_prompt = f"{current_prompt}\nObservation: {json.dumps(result)}"
            
        return self._generate_final_result(history)
        
    except Exception as e:
        logger.error(f"ReAct æ‰§è¡Œå¤±è´¥: {str(e)}")
        return {
            "error": f"æ‰§è¡Œå¤±è´¥: {str(e)}",
            "is_valid": False,
            "risk_points": [f"æ‰§è¡Œå¤±è´¥: {str(e)}"]
        }
```

### 2.2 è§„åˆ™è§£æå™¨

è§„åˆ™è§£æå™¨æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£å°†è‡ªç„¶è¯­è¨€å½¢å¼çš„æ³•å¾‹æ¡æ–‡è½¬æ¢ä¸ºæœºå™¨å¯ç†è§£çš„ç»“æ„åŒ–è§„åˆ™ã€‚ä¸»è¦æŠ€æœ¯ç‚¹åŒ…æ‹¬ï¼š

1. âœï¸ **æç¤ºè¯å·¥ç¨‹**ï¼šè®¾è®¡ä¸“é—¨çš„æç¤ºè¯æ¨¡æ¿å¼•å¯¼ LLM è§£æ
2. âœ… **è§„åˆ™éªŒè¯**ï¼šç¡®ä¿è§£æç»“æœçš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§
3. ğŸ”— **å·¥å…·æ˜ å°„**ï¼šå°†è§„åˆ™ä¸å…·ä½“çš„éªŒè¯å·¥å…·å…³è”

<details>
<summary><b>ç¤ºä¾‹è§„åˆ™ç»“æ„</b> (ç‚¹å‡»å±•å¼€)</summary>

```json
{
    "rules": [
        {
            "rule_id": "RULE_001",
            "rule_type": "content_requirement",
            "source": "ç¬¬ä¸ƒæ¡",
            "description": "ä¿å¥é£Ÿå“å¹¿å‘Šå†…å®¹ç®¡ç†è§„å®š",
            "requirements": [
                {
                    "type": "content_check",
                    "content": "å¹¿å‘Šå†…å®¹å¿…é¡»ä»¥æ³¨å†Œè¯ä¹¦ä¸ºå‡†",
                    "mandatory": true
                }
            ],
            "tools_required": [
                {
                    "tool": "text_recognition", 
                    "purpose": "æ£€æŸ¥æ–‡æœ¬å†…å®¹",
                    "expected_result": "æ–‡æœ¬å†…å®¹ç¬¦åˆæ³¨å†Œè¯ä¹¦"
                }
            ]
        }
    ]
}
``` 
</details>

### 2.3 æ™ºèƒ½æç¤ºè¯è®¾è®¡

æç¤ºè¯è®¾è®¡æ˜¯ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§çš„å…³é”®ã€‚æˆ‘ä»¬é‡‡ç”¨äº†æ¨¡æ¿åŒ–çš„æç¤ºè¯ç®¡ç†æ–¹å¼ï¼š

```python
def get_audit_prompt(self, 
                    text_data: str,
                    tools: Dict[str, Any],
                    rules: List[Dict[str, Any]],
                    context: Optional[Dict[str, Any]] = None) -> str:
    """æ„å»ºå®¡æ ¸æç¤ºè¯"""
    # æ„å»ºå·¥å…·æè¿°
    tool_descriptions = []
    for name, info in tools.items():
        desc = f"{name}: {info['description']}\n" \
               f"å‚æ•°: {', '.join(info['required_params'])}"
        tool_descriptions.append(desc)
    
    # æ„å»ºå®Œæ•´æç¤ºè¯
    prompt = self.react_template.format(
        tools='\n\n'.join(tool_descriptions),
        tool_names=','.join(tools.keys()),
        text_content=text_data,
        image_info=json.dumps(context.get('image_info', {})),
        rules=json.dumps(rules, ensure_ascii=False, indent=2)
    )
    
    return prompt
```

---

## 3. å®è·µæ¡ˆä¾‹åˆ†æ

> è®©æˆ‘ä»¬ä»¥ä¸€ä¸ªä¿å¥é£Ÿå“å¹¿å‘Šå®¡æ ¸çš„å®é™…æ¡ˆä¾‹æ¥è¯´æ˜ç³»ç»Ÿçš„å·¥ä½œæµç¨‹

### æ¡ˆä¾‹æµç¨‹

1. **åœºæ™¯è¯†åˆ«**ï¼š
   - âœ¨ ç³»ç»Ÿé¦–å…ˆè¯†åˆ«å‡ºè¿™æ˜¯ä¸€ä¸ªä¿å¥é£Ÿå“å¹¿å‘Š
   - âœ¨ è‡ªåŠ¨åŠ è½½ç›¸å…³çš„æ³•è§„è§„åˆ™
   
2. **å†…å®¹å®¡æ ¸**ï¼š
   - âœ¨ ä½¿ç”¨ OCR å·¥å…·æå–å¹¿å‘Šæ–‡æœ¬
   - âœ¨ æ£€æŸ¥å¿…è¦å£°æ˜çš„æ˜¾è‘—æ€§
   - âœ¨ éªŒè¯ä¿å¥é£Ÿå“æ ‡å¿—çš„å­˜åœ¨
   
3. **é£é™©è¯„ä¼°**ï¼š
   - âœ¨ æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¶…å‡ºæ‰¹å‡†èŒƒå›´çš„åŠŸæ•ˆå£°æ˜
   - âœ¨ éªŒè¯è­¦ç¤ºè¯­çš„è§„èŒƒæ€§
   - âœ¨ ç”Ÿæˆé£é™©è¯„ä¼°æŠ¥å‘Š

---

## 4. æœ€ä½³å®è·µå»ºè®®

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æ€»ç»“å‡ºä»¥ä¸‹æœ€ä½³å®è·µï¼š

### 4.1 è§„åˆ™è§£æä¼˜åŒ–

1. **ä½¿ç”¨æ¸è¿›å¼æ¸©åº¦è°ƒèŠ‚**ï¼š
```python
# éšé‡è¯•æ¬¡æ•°é™ä½æ¸©åº¦ï¼Œæé«˜ç¡®å®šæ€§
temperature = max(0.1, 0.7 - attempt * 0.2)
```

2. **å®ç°å¤šçº§é”™è¯¯å¤„ç†**ï¼š
```python
try:
    # æ¸…ç†å“åº”æ–‡æœ¬
    json_text = self._clean_json(response)
    parsed_rules = json.loads(json_text)
    
    # éªŒè¯è§„åˆ™æ ¼å¼
    if not self._validate_rules(parsed_rules):
        logger.warning("è§„åˆ™æ ¼å¼éªŒè¯å¤±è´¥")
        continue
except json.JSONDecodeError as e:
    logger.error(f"JSONè§£æå¤±è´¥: {str(e)}")
    return {"error": f"è§„åˆ™è§£æå¤±è´¥: {str(e)}"}
```

### 4.2 ReAct æ‰§è¡Œä¼˜åŒ–

| ä¼˜åŒ–æ–¹å‘ | å…·ä½“å®æ–½æ–¹æ³• |
|---------|------------|
| æ­¥æ•°é™åˆ¶ | è®¾ç½®åˆç†çš„æœ€å¤§æ­¥æ•°é™åˆ¶ |
| å†å²è¿½è¸ª | å®ç°å†å²è®°å½•è¿½è¸ª |
| å®¹é”™æœºåˆ¶ | æ·»åŠ è¶…æ—¶ä¿æŠ¤æœºåˆ¶ |

### 4.3 æç¤ºè¯ç®¡ç†

- ğŸ“ **ä½¿ç”¨æ¨¡æ¿åŒ–ç®¡ç†**
- ğŸ“ **æ·»åŠ ç¤ºä¾‹å¼•å¯¼**
- ğŸ“ **å®ç°åŠ¨æ€å‚æ•°æ›¿æ¢**

---

## 5. æœªæ¥å±•æœ›

ç³»ç»Ÿè¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹å‘å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š

### 1. è§„åˆ™åº“æ‰©å±•
- ğŸ”® æ”¯æŒæ›´å¤šè¡Œä¸šæ³•è§„
- ğŸ”® å®ç°è§„åˆ™è‡ªåŠ¨æ›´æ–°

### 2. å®¡æ ¸èƒ½åŠ›å¢å¼º
- ğŸ”® æ·»åŠ æ›´å¤šä¸“ä¸šå·¥å…·
- ğŸ”® æé«˜åœºæ™¯è¯†åˆ«å‡†ç¡®ç‡

### 3. æ€§èƒ½ä¼˜åŒ–
- ğŸ”® å®ç°è§„åˆ™ç¼“å­˜
- ğŸ”® ä¼˜åŒ–å·¥å…·è°ƒç”¨é“¾è·¯

---

## 6. æ€»ç»“

åŸºäº ReAct æ¶æ„çš„æ™ºèƒ½æ³•è§„å®¡æ ¸ç³»ç»Ÿé€šè¿‡ç»“åˆ LLM çš„æ¨ç†èƒ½åŠ›å’Œä¸“ä¸šå·¥å…·çš„æ‰§è¡Œèƒ½åŠ›ï¼Œå®ç°äº†é«˜æ•ˆã€å‡†ç¡®çš„æ–‡æ¡£åˆè§„æ€§å®¡æ ¸ã€‚ç³»ç»Ÿçš„æ¨¡å—åŒ–è®¾è®¡å’Œçµæ´»çš„æ¶æ„ä¸ºæœªæ¥çš„æ‰©å±•å’Œä¼˜åŒ–æä¾›äº†è‰¯å¥½çš„åŸºç¡€ã€‚

### å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“ï¼š
- â­ **ReAct æ¶æ„**å®ç°å¤æ‚æ¨ç†
- â­ **ç»“æ„åŒ–è§„åˆ™è§£æ**å’ŒéªŒè¯
- â­ **æ™ºèƒ½æç¤ºè¯å·¥ç¨‹**
- â­ **å¤šæ¨¡æ€å·¥å…·é›†æˆ**

> å¸Œæœ›æœ¬æ–‡çš„ç»éªŒåˆ†äº«èƒ½å¤Ÿå¸®åŠ©æ›´å¤šå¼€å‘è€…åœ¨ AI åº”ç”¨å¼€å‘ä¸­å°‘èµ°å¼¯è·¯ã€‚

---

## å‚è€ƒèµ„æ–™

1. [ReAct: Synergizing Reasoning and Acting in Language Models](https://arxiv.org/abs/2210.03629)
2. ã€Šä¸­åäººæ°‘å…±å’Œå›½å¹¿å‘Šæ³•ã€‹
3. [FastAPI å®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
4. [LangChain æ–‡æ¡£](https://python.langchain.com/docs/get_started/introduction)