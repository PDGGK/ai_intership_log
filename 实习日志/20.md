## æŠ€æœ¯å­¦ä¹ æ—¥å¿—

## 2024-12-05 æŠ€æœ¯å­¦ä¹ æ—¥å¿—

<div align="center">
  <img src="https://img.shields.io/badge/FastAPI-009688?style=for-the-badge&logo=fastapi&logoColor=white"/>
  <img src="https://img.shields.io/badge/Python-3776AB?style=for-the-badge&logo=python&logoColor=white"/>
  <img src="https://img.shields.io/badge/OpenAI-412991?style=for-the-badge&logo=openai&logoColor=white"/>
  <img src="https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=git&logoColor=white"/>
</div>

### ğŸ¯ æ ¸å¿ƒé—®é¢˜æ¢³ç†

#### 1. ğŸ”§ åœºæ™¯å¼€å‘é—®é¢˜
- **é—®é¢˜æè¿°**: å¤„æ–¹è¯å¹¿å‘Šå®¡æ ¸åœºæ™¯çš„å®ç°ä¸éƒ¨ç½²
- **ä¸»è¦æŒ‘æˆ˜**:
  - JSONè§£æé”™è¯¯çš„å¤„ç†
  - è·¯ç”±æ³¨å†Œå’Œè®¿é—®é—®é¢˜
  - æ–‡ä»¶æ ¼å¼æ”¯æŒçš„ç¡®è®¤

#### 2. ğŸŒ ç³»ç»Ÿè¿æ¥é—®é¢˜
- **é—®é¢˜æè¿°**: SSHè¿æ¥å¤±è´¥é—®é¢˜æ’æŸ¥
- **æ¶‰åŠå†…å®¹**: è¿œç¨‹è¿æ¥é…ç½®ä¸ç½‘ç»œè¯Šæ–­

### ğŸ“š çŸ¥è¯†ç‚¹æ‹“å±•

#### 1. âš¡ FastAPIåº”ç”¨å¼€å‘
- **è·¯ç”±æ³¨å†Œæœºåˆ¶**
  - è·¯ç”±è£…é¥°å™¨çš„ä½¿ç”¨
  - è¯·æ±‚å¤„ç†æµç¨‹
  - é”™è¯¯å¤„ç†ä¸­é—´ä»¶

#### 2. ğŸ“‚ æ–‡ä»¶å¤„ç†èƒ½åŠ›
- **æ”¯æŒçš„æ–‡ä»¶ç±»å‹**:
```python
SUPPORTED_IMAGE_TYPES = frozenset({
    'image/jpeg',
    'image/png',
    'image/gif',
    'image/bmp',
    'application/pdf'
})
```
- **æ‰¹å¤„ç†æœºåˆ¶**:
  > batch_sizeå‚æ•°ç”¨äºæ§åˆ¶æ–‡ä»¶å¤„ç†çš„æ‰¹é‡å¤§å°ï¼Œéœ€è¦æ ¹æ®å®é™…åœºæ™¯è°ƒæ•´ä»¥å¹³è¡¡æ€§èƒ½å’Œèµ„æºæ¶ˆè€—

### ğŸ”¬ æŠ€æœ¯æ·±åº¦è§£æ

#### 1. ğŸ”„ åœºæ™¯å¤„ç†æµç¨‹ä¼˜åŒ–
1. **ç®€åŒ–å‰çš„é—®é¢˜** âš ï¸:
   - å¤æ‚çš„JSONå¤„ç†é€»è¾‘
   - å¤šä½™çš„æ•°æ®æ¨¡å‹è½¬æ¢
   - å†—ä½™çš„é”™è¯¯å¤„ç†å±‚çº§

2. **ä¼˜åŒ–åçš„å®ç°** âœ¨:
```python
async def recognize_prescription_ad_api(
    advertisement_file: UploadFile = File(...),
    batch_size: int = Form(default=1)
) -> BaseJudgementResponse:
    vl_prompt = ("è¯·ä»”ç»†è¯†åˆ«æ˜¯å¦æœ‰æ˜¾è‘—æ ‡æ˜'æœ¬å¹¿å‘Šä»…ä¾›åŒ»å­¦è¯å­¦ä¸“ä¸šäººå£«é˜…è¯»'...")
    try:
        processed_doc = await recognizeImageTextVL(
            advertisement_file, 
            prompt=vl_prompt, 
            batch_size=batch_size
        )
        content = "\n".join([page["content"] for page in processed_doc["pages"]])
        result = await llm_chat(query=advertisement_query)
        return BaseJudgementResponse(
            code=200,
            msg="è¯†åˆ«æˆåŠŸ",
            data=BaseJudgement(
                is_illegal=True if "æœªæ˜¾è‘—æ ‡æ˜" in result else False,
                reason=result
            )
        )
    except Exception as e:
        return BaseJudgementResponse(
            code=400,
            msg=f"å¤„ç†å¤±è´¥: {str(e)}",
            data=None
        )
```

#### 2. âš ï¸ é”™è¯¯å¤„ç†ç­–ç•¥
- **ç»Ÿä¸€å“åº”æ ¼å¼**
- **ç²¾ç¡®çš„é”™è¯¯å®šä½**
- **å‹å¥½çš„é”™è¯¯æç¤º**

### ğŸ—ºï¸ çŸ¥è¯†å›¾è°±æ„å»º

#### 1. ğŸ”— æŠ€æœ¯æ ˆå…³è”
- **Webæ¡†æ¶**: FastAPI
- **æ–‡ä»¶å¤„ç†**: UploadFile, PDFå¤„ç†
- **å›¾åƒè¯†åˆ«**: VLæ¨¡å‹é›†æˆ
- **å“åº”å¤„ç†**: Pydanticæ¨¡å‹
- **éƒ¨ç½²ç›¸å…³**: Git, SSHé…ç½®

#### 2. âœ¨ æœ€ä½³å®è·µæ€»ç»“
1. **ä»£ç ç»„ç»‡** ğŸ“¦:
   - ä¿æŒå‡½æ•°èŒè´£å•ä¸€
   - ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ¨¡å‹
   - åˆç†çš„é”™è¯¯å¤„ç†æœºåˆ¶

2. **ç³»ç»Ÿé…ç½®** âš™ï¸:
   - åˆç†è®¾ç½®batch_size
   - æ­£ç¡®é…ç½®æ–‡ä»¶å¤„ç†å‚æ•°
   - å®Œå–„çš„è·¯ç”±æ³¨å†Œ

3. **éƒ¨ç½²æ³¨æ„äº‹é¡¹** ğŸš€:
   - Gitåˆ†æ”¯ç®¡ç†è§„èŒƒ
   - SSHè¿æ¥é…ç½®æ£€æŸ¥
   - æœåŠ¡å™¨ç½‘ç»œé…ç½®éªŒè¯

#### 3. ğŸ”„ å¾…ä¼˜åŒ–ç‚¹
1. **æ€§èƒ½ä¼˜åŒ–** âš¡:
   - æ‰¹å¤„ç†å‚æ•°è°ƒä¼˜
   - å“åº”æ—¶é—´ä¼˜åŒ–
   - èµ„æºåˆ©ç”¨ä¼˜åŒ–

2. **ä»£ç è´¨é‡** ğŸ“:
   - å®Œå–„é”™è¯¯å¤„ç†
   - æ·»åŠ è¯¦ç»†æ³¨é‡Š
   - ä¼˜åŒ–ä»£ç ç»“æ„